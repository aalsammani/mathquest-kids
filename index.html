<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathQuest Kids - Learn Math K-3</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }

        .app-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 800px;
            min-height: 600px;
            overflow: hidden;
            position: relative;
        }

        .header {
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7);
            background-size: 300% 300%;
            animation: gradient 6s ease infinite;
            padding: 20px;
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
        }

        .grade-selector {
            padding: 20px;
            text-align: center;
            background: #f8f9ff;
        }

        .grade-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
        }

        .grade-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(255, 107, 107, 0.4);
        }

        .grade-btn.active {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            box-shadow: 0 8px 20px rgba(78, 205, 196, 0.4);
        }

        .topic-selector {
            padding: 20px;
            display: none;
            background: #f0f4ff;
        }

        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .topic-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 3px solid transparent;
        }

        .topic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            border-color: #ff6b6b;
        }

        .topic-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .game-area {
            padding: 30px;
            display: none;
            text-align: center;
            min-height: 400px;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .question-display {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin: 20px 0;
            font-size: 2.5em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .visual-area {
            margin: 20px 0;
            min-height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .visual-item {
            width: 40px;
            height: 40px;
            background: #ff6b6b;
            border-radius: 50%;
            display: inline-block;
            margin: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(255, 107, 107, 0.3);
        }

        .visual-item.apple { background: #ff6b6b; }
        .visual-item.orange { background: #ffa726; }
        .visual-item.green { background: #66bb6a; }
        .visual-item.blue { background: #42a5f5; }
        .visual-item.purple { background: #ab47bc; }

        .answer-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        .answer-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(78, 205, 196, 0.3);
        }

        .answer-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(78, 205, 196, 0.4);
        }

        .answer-btn.correct {
            background: linear-gradient(45deg, #66bb6a, #4caf50);
            animation: bounce 0.6s ease;
        }

        .answer-btn.incorrect {
            background: linear-gradient(45deg, #ef5350, #f44336);
            animation: shake 0.5s ease;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
            display: none;
        }

        .feedback.correct {
            background: linear-gradient(135deg, #c8e6c9, #a5d6a7);
            color: #2e7d32;
        }

        .feedback.incorrect {
            background: linear-gradient(135deg, #ffcdd2, #ef9a9a);
            color: #c62828;
        }

        .controls {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(102, 126, 234, 0.4);
        }

        .score-display {
            background: linear-gradient(135deg, #ffd54f, #ffb300);
            color: #bf360c;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 20px;
            display: inline-block;
            box-shadow: 0 8px 20px rgba(255, 213, 79, 0.3);
        }

        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff6b6b;
            animation: fall 3s linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }

        .hidden { display: none; }
        .show { display: block; }

        @media (max-width: 600px) {
            .app-container {
                width: 95%;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .question-display {
                font-size: 1.8em;
                padding: 25px;
            }
            
            .answer-btn {
                padding: 15px;
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <h1>üåü MathQuest Kids üåü</h1>
            <p>Fun Math Adventures for Little Learners!</p>
        </header>

        <!-- Grade Selection -->
        <div id="gradeSelection" class="grade-selector">
            <h2>Choose Your Grade Level:</h2>
            <button class="grade-btn" data-grade="k">üéà Kindergarten</button>
            <button class="grade-btn" data-grade="1">üöÄ Grade 1</button>
            <button class="grade-btn" data-grade="2">‚≠ê Grade 2</button>
            <button class="grade-btn" data-grade="3">üèÜ Grade 3</button>
        </div>

        <!-- Topic Selection -->
        <div id="topicSelection" class="topic-selector">
            <h2>Choose a Math Adventure:</h2>
            <div class="topic-grid" id="topicGrid">
                <!-- Topics will be populated by JavaScript -->
            </div>
        </div>

        <!-- Game Area -->
        <div id="gameArea" class="game-area">
            <div class="score-display" id="scoreDisplay">Score: 0 | Streak: 0</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="question-display" id="questionDisplay"></div>
            <div class="visual-area" id="visualArea"></div>
            <div class="answer-options" id="answerOptions"></div>
            <div class="feedback" id="feedback"></div>
            <div class="controls">
                <button class="control-btn" id="nextBtn" style="display: none;">Next Question ‚Üí</button>
                <button class="control-btn" id="backBtn">‚Üê Back to Topics</button>
                <button class="control-btn" id="hintBtn">üí° Hint</button>
            </div>
        </div>
    </div>

    <div class="celebration" id="celebration"></div>

    <script>
        class MathQuestApp {
            constructor() {
                this.currentGrade = null;
                this.currentTopic = null;
                this.currentQuestion = null;
                this.score = 0;
                this.streak = 0;
                this.questionCount = 0;
                this.totalQuestions = 10;
                this.questionsCorrect = 0;
                
                this.topics = {
                    k: [
                        { id: 'counting', name: 'Counting 1-10', icon: 'üî¢', description: 'Count objects and numbers' },
                        { id: 'shapes', name: 'Shapes', icon: '‚ö™', description: 'Learn basic shapes' },
                        { id: 'patterns', name: 'Patterns', icon: 'üî¥üîµ', description: 'Simple patterns' },
                        { id: 'size', name: 'Big & Small', icon: 'üìè', description: 'Compare sizes' }
                    ],
                    1: [
                        { id: 'addition10', name: 'Addition to 10', icon: '‚ûï', description: 'Add numbers up to 10' },
                        { id: 'subtraction10', name: 'Subtraction to 10', icon: '‚ûñ', description: 'Subtract numbers up to 10' },
                        { id: 'counting20', name: 'Counting to 20', icon: 'üî¢', description: 'Count higher numbers' },
                        { id: 'place_value', name: 'Tens & Ones', icon: 'üîü', description: 'Understanding place value' }
                    ],
                    2: [
                        { id: 'addition100', name: 'Addition to 100', icon: '‚ûï', description: 'Add bigger numbers' },
                        { id: 'subtraction100', name: 'Subtraction to 100', icon: '‚ûñ', description: 'Subtract bigger numbers' },
                        { id: 'skip_counting', name: 'Skip Counting', icon: '‚è≠Ô∏è', description: 'Count by 2s, 5s, 10s' },
                        { id: 'time', name: 'Time', icon: 'üïê', description: 'Reading clocks' }
                    ],
                    3: [
                        { id: 'multiplication', name: 'Multiplication', icon: '‚úñÔ∏è', description: 'Times tables' },
                        { id: 'division', name: 'Division', icon: '‚ûó', description: 'Sharing equally' },
                        { id: 'fractions', name: 'Fractions', icon: 'üçï', description: 'Parts of a whole' },
                        { id: 'measurement', name: 'Measurement', icon: 'üìê', description: 'Length and weight' }
                    ]
                };
                
                this.initializeApp();
            }

            initializeApp() {
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Grade selection
                document.querySelectorAll('.grade-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.selectGrade(e.target.dataset.grade);
                    });
                });

                // Control buttons
                document.getElementById('backBtn').addEventListener('click', () => {
                    this.showTopicSelection();
                });

                document.getElementById('nextBtn').addEventListener('click', () => {
                    this.nextQuestion();
                });

                document.getElementById('hintBtn').addEventListener('click', () => {
                    this.showHint();
                });
            }

            selectGrade(grade) {
                this.currentGrade = grade;
                
                // Update active grade button
                document.querySelectorAll('.grade-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-grade="${grade}"]`).classList.add('active');
                
                this.showTopicSelection();
            }

            showTopicSelection() {
                document.getElementById('gradeSelection').style.display = 'none';
                document.getElementById('gameArea').style.display = 'none';
                document.getElementById('topicSelection').style.display = 'block';
                
                this.populateTopics();
            }

            populateTopics() {
                const topicGrid = document.getElementById('topicGrid');
                topicGrid.innerHTML = '';
                
                this.topics[this.currentGrade].forEach(topic => {
                    const topicCard = document.createElement('div');
                    topicCard.className = 'topic-card';
                    topicCard.innerHTML = `
                        <div class="topic-icon">${topic.icon}</div>
                        <h3>${topic.name}</h3>
                        <p>${topic.description}</p>
                    `;
                    topicCard.addEventListener('click', () => {
                        this.selectTopic(topic.id);
                    });
                    topicGrid.appendChild(topicCard);
                });
            }

            selectTopic(topicId) {
                this.currentTopic = topicId;
                this.score = 0;
                this.streak = 0;
                this.questionCount = 0;
                this.questionsCorrect = 0;
                
                document.getElementById('topicSelection').style.display = 'none';
                document.getElementById('gameArea').style.display = 'block';
                
                this.startGame();
            }

            startGame() {
                this.updateScore();
                this.nextQuestion();
            }

            nextQuestion() {
                if (this.questionCount >= this.totalQuestions) {
                    this.endGame();
                    return;
                }

                this.questionCount++;
                this.clearFeedback();
                document.getElementById('nextBtn').style.display = 'none';
                
                this.currentQuestion = this.generateQuestion();
                this.displayQuestion();
                this.updateProgress();
            }

            generateQuestion() {
                const generators = {
                    // Kindergarten
                    counting: () => this.generateCounting(),
                    shapes: () => this.generateShapes(),
                    patterns: () => this.generatePatterns(),
                    size: () => this.generateSize(),
                    
                    // Grade 1
                    addition10: () => this.generateAddition(10),
                    subtraction10: () => this.generateSubtraction(10),
                    counting20: () => this.generateCountingHigher(),
                    place_value: () => this.generatePlaceValue(),
                    
                    // Grade 2
                    addition100: () => this.generateAddition(100),
                    subtraction100: () => this.generateSubtraction(100),
                    skip_counting: () => this.generateSkipCounting(),
                    time: () => this.generateTime(),
                    
                    // Grade 3
                    multiplication: () => this.generateMultiplication(),
                    division: () => this.generateDivision(),
                    fractions: () => this.generateFractions(),
                    measurement: () => this.generateMeasurement()
                };

                return generators[this.currentTopic]();
            }

            generateCounting() {
                const max = Math.floor(Math.random() * 5) + 3; // 3-7 objects
                const colors = ['apple', 'orange', 'green', 'blue', 'purple'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                const wrongAnswers = [];
                while (wrongAnswers.length < 3) {
                    const wrong = Math.floor(Math.random() * 10) + 1;
                    if (wrong !== max && !wrongAnswers.includes(wrong)) {
                        wrongAnswers.push(wrong);
                    }
                }

                return {
                    question: "How many objects do you see?",
                    visual: { type: 'objects', count: max, color: color },
                    correct: max,
                    options: [max, ...wrongAnswers].sort(() => Math.random() - 0.5),
                    hint: `Try counting each object: 1, 2, 3...`
                };
            }

            generateShapes() {
                const shapes = [
                    { name: 'circle', symbol: '‚ö™', sides: 'curved' },
                    { name: 'square', symbol: '‚¨ú', sides: '4 equal' },
                    { name: 'triangle', symbol: 'üî∫', sides: '3' },
                    { name: 'rectangle', symbol: '‚ñ≠', sides: '4' }
                ];
                const shape = shapes[Math.floor(Math.random() * shapes.length)];
                const wrongShapes = shapes.filter(s => s !== shape).slice(0, 3);

                return {
                    question: `Which shape is this? ${shape.symbol}`,
                    visual: { type: 'shape', shape: shape.symbol },
                    correct: shape.name,
                    options: [shape.name, ...wrongShapes.map(s => s.name)].sort(() => Math.random() - 0.5),
                    hint: `This shape has ${shape.sides} sides.`
                };
            }

            generatePatterns() {
                const patterns = [
                    { pattern: ['üî¥', 'üîµ'], next: 'üî¥' },
                    { pattern: ['‚≠ê', '‚≠ê', '‚ù§Ô∏è'], next: '‚≠ê' },
                    { pattern: ['üü°', 'üü¢', 'üü°'], next: 'üü¢' }
                ];
                const selected = patterns[Math.floor(Math.random() * patterns.length)];
                
                return {
                    question: "What comes next in the pattern?",
                    visual: { type: 'pattern', pattern: [...selected.pattern, ...selected.pattern, '?'] },
                    correct: selected.next,
                    options: ['üî¥', 'üîµ', '‚≠ê', '‚ù§Ô∏è', 'üü°', 'üü¢'].slice(0, 4),
                    hint: "Look for the repeating pattern!"
                };
            }

            generateSize() {
                const sizes = ['big', 'small'];
                const correct = sizes[Math.floor(Math.random() * 2)];
                
                return {
                    question: "Which circle is bigger?",
                    visual: { type: 'size', big: true },
                    correct: correct,
                    options: ['big', 'small'],
                    hint: "Compare the sizes carefully!"
                };
            }

            generateAddition(max) {
                const a = Math.floor(Math.random() * (max/2)) + 1;
                const b = Math.floor(Math.random() * (max - a)) + 1;
                const sum = a + b;
                
                const wrongAnswers = [];
                while (wrongAnswers.length < 3) {
                    const wrong = sum + Math.floor(Math.random() * 6) - 3;
                    if (wrong > 0 && wrong !== sum && !wrongAnswers.includes(wrong)) {
                        wrongAnswers.push(wrong);
                    }
                }

                return {
                    question: `${a} + ${b} = ?`,
                    visual: { type: 'addition', a: a, b: b },
                    correct: sum,
                    options: [sum, ...wrongAnswers].sort(() => Math.random() - 0.5),
                    hint: `Count all the objects together!`
                };
            }

            generateSubtraction(max) {
                const start = Math.floor(Math.random() * max/2) + 3;
                const subtract = Math.floor(Math.random() * (start - 1)) + 1;
                const result = start - subtract;
                
                const wrongAnswers = [];
                while (wrongAnswers.length < 3) {
                    const wrong = result + Math.floor(Math.random() * 6) - 3;
                    if (wrong >= 0 && wrong !== result && !wrongAnswers.includes(wrong)) {
                        wrongAnswers.push(wrong);
                    }
                }

                return {
                    question: `${start} - ${subtract} = ?`,
                    visual: { type: 'subtraction', start: start, subtract: subtract },
                    correct: result,
                    options: [result, ...wrongAnswers].sort(() => Math.random() - 0.5),
                    hint: `Take away ${subtract} objects from ${start}.`
                };
            }

            generateCountingHigher() {
                const start = Math.floor(Math.random() * 10) + 10;
                const count = Math.floor(Math.random() * 5) + 3;
                
                return {
                    question: `Count from ${start}. What comes after ${start + count - 1}?`,
                    visual: null,
                    correct: start + count,
                    options: [start + count, start + count + 1, start + count - 1, start + count + 2],
                    hint: `Keep counting: ${start}, ${start + 1}, ${start + 2}...`
                };
            }

            generatePlaceValue() {
                const tens = Math.floor(Math.random() * 3) + 1;
                const ones = Math.floor(Math.random() * 9) + 1;
                const number = tens * 10 + ones;
                
                return {
                    question: `How many ones are in ${number}?`,
                    visual: { type: 'place_value', number: number },
                    correct: ones,
                    options: [ones, tens, number, ones + tens].sort(() => Math.random() - 0.5),
                    hint: `Look at the ones place (the right digit).`
                };
            }

            generateSkipCounting() {
                const skip = [2, 5, 10][Math.floor(Math.random() * 3)];
                const start = skip * 2;
                const sequence = [start, start + skip, start + skip * 2];
                
                return {
                    question: `Skip counting by ${skip}s: ${sequence.join(', ')}, ?`,
                    visual: null,
                    correct: start + skip * 3,
                    options: [start + skip * 3, start + skip * 3 + 1, start + skip * 3 - 1, start + skip * 4],
                    hint: `Add ${skip} to the last number.`
                };
            }

            generateTime() {
                const hour = Math.floor(Math.random() * 12) + 1;
                const minute = [0, 30][Math.floor(Math.random() * 2)];
                const timeStr = minute === 0 ? `${hour}:00` : `${hour}:30`;
                
                return {
                    question: `What time does this show?`,
                    visual: { type: 'clock', hour: hour, minute: minute },
                    correct: timeStr,
                    options: [timeStr, `${hour + 1}:00`, `${hour}:15`, `${hour}:45`],
                    hint: `Look at where the hour and minute hands point.`
                };
            }

            generateMultiplication() {
                const a = Math.floor(Math.random() * 5) + 2;
                const b = Math.floor(Math.random() * 5) + 2;
                const product = a * b;
                
                return {
                    question: `${a} √ó ${b} = ?`,
                    visual: { type: 'multiplication', a: a, b: b },
                    correct: product,
                    options: [product, product + 1, product - 1, product + a].sort(() => Math.random() - 0.5),
                    hint: `Think of it as ${a} groups of ${b}.`
                };
            }

            generateDivision() {
                const divisor = Math.floor(Math.random() * 4) + 2;
                const quotient = Math.floor(Math.random() * 5) + 2;
                const dividend = divisor * quotient;
                
                return {
                    question: `${dividend} √∑ ${divisor} = ?`,
                    visual: { type: 'division', total: dividend, groups: divisor },
                    correct: quotient,
                    options: [quotient, quotient + 1, quotient - 1, divisor].sort(() => Math.random() - 0.5),
                    hint: `How many groups of ${divisor} make ${dividend}?`
                };
            }

            generateFractions() {
                const denominators = [2, 3, 4];
                const denominator = denominators[Math.floor(Math.random() * denominators.length)];
                const numerator = Math.floor(Math.random() * denominator) + 1;
                
                return {
                    question: `What fraction is shaded?`,
                    visual: { type: 'fraction', numerator: numerator, denominator: denominator },
                    correct: `${numerator}/${denominator}`,
                    options: [`${numerator}/${denominator}`, `${denominator}/${numerator}`, `${numerator + 1}/${denominator}`, `${numerator}/${denominator + 1}`],
                    hint: `Count the shaded parts out of total parts.`
                };
            }

            generateMeasurement() {
                const units = [
                    { item: 'pencil', length: 6, unit: 'inches' },
                    { item: 'book', length: 9, unit: 'inches' },
                    { item: 'table', length: 3, unit: 'feet' }
                ];
                const selected = units[Math.floor(Math.random() * units.length)];
                
                return {
                    question: `How long is the ${selected.item}?`,
                    visual: { type: 'measurement', item: selected.item, length: selected.length },
                    correct: `${selected.length} ${selected.unit}`,
                    options: [`${selected.length} ${selected.unit}`, `${selected.length + 1} ${selected.unit}`, `${selected.length - 1} ${selected.unit}`, `${selected.length} cm`],
                    hint: `Use the ruler to measure carefully.`
                };
            }

            displayQuestion() {
                document.getElementById('questionDisplay').textContent = this.currentQuestion.question;
                this.displayVisual();
                this.displayAnswerOptions();
            }

            displayVisual() {
                const visualArea = document.getElementById('visualArea');
                visualArea.innerHTML = '';
                
                if (!this.currentQuestion.visual) return;
                
                const visual = this.currentQuestion.visual;
                
                switch (visual.type) {
                    case 'objects':
                        for (let i = 0; i < visual.count; i++) {
                            const item = document.createElement('div');
                            item.className = `visual-item ${visual.color}`;
                            visualArea.appendChild(item);
                        }
                        break;
                        
                    case 'shape':
                        const shapeDiv = document.createElement('div');
                        shapeDiv.style.fontSize = '4em';
                        shapeDiv.textContent = visual.shape;
                        visualArea.appendChild(shapeDiv);
                        break;
                        
                    case 'pattern':
                        visual.pattern.forEach(item => {
                            const patternItem = document.createElement('span');
                            patternItem.style.fontSize = '2em';
                            patternItem.style.margin = '0 10px';
                            patternItem.textContent = item;
                            visualArea.appendChild(patternItem);
                        });
                        break;
                        
                    case 'size':
                        const bigCircle = document.createElement('div');
                        bigCircle.style.width = '80px';
                        bigCircle.style.height = '80px';
                        bigCircle.style.borderRadius = '50%';
                        bigCircle.style.backgroundColor = '#4ecdc4';
                        bigCircle.style.margin = '10px';
                        bigCircle.style.display = 'inline-block';
                        
                        const smallCircle = document.createElement('div');
                        smallCircle.style.width = '40px';
                        smallCircle.style.height = '40px';
                        smallCircle.style.borderRadius = '50%';
                        smallCircle.style.backgroundColor = '#ff6b6b';
                        smallCircle.style.margin = '10px';
                        smallCircle.style.display = 'inline-block';
                        
                        visualArea.appendChild(bigCircle);
                        visualArea.appendChild(smallCircle);
                        break;
                        
                    case 'addition':
                        // Show visual addition with objects
                        for (let i = 0; i < visual.a; i++) {
                            const item = document.createElement('div');
                            item.className = 'visual-item blue';
                            visualArea.appendChild(item);
                        }
                        
                        const plusSign = document.createElement('span');
                        plusSign.style.fontSize = '2em';
                        plusSign.style.margin = '0 20px';
                        plusSign.textContent = '+';
                        visualArea.appendChild(plusSign);
                        
                        for (let i = 0; i < visual.b; i++) {
                            const item = document.createElement('div');
                            item.className = 'visual-item green';
                            visualArea.appendChild(item);
                        }
                        break;
                        
                    case 'subtraction':
                        for (let i = 0; i < visual.start; i++) {
                            const item = document.createElement('div');
                            item.className = 'visual-item apple';
                            if (i >= visual.start - visual.subtract) {
                                item.style.opacity = '0.3';
                                item.style.textDecoration = 'line-through';
                            }
                            visualArea.appendChild(item);
                        }
                        break;
                        
                    case 'place_value':
                        const tensDiv = document.createElement('div');
                        tensDiv.innerHTML = `<h3>Tens: ${Math.floor(visual.number / 10)}</h3>`;
                        const onesDiv = document.createElement('div');
                        onesDiv.innerHTML = `<h3>Ones: ${visual.number % 10}</h3>`;
                        visualArea.appendChild(tensDiv);
                        visualArea.appendChild(onesDiv);
                        break;
                        
                    case 'clock':
                        const clockDiv = document.createElement('div');
                        clockDiv.innerHTML = `üïê`;
                        clockDiv.style.fontSize = '4em';
                        const timeLabel = document.createElement('div');
                        timeLabel.textContent = visual.minute === 0 ? 'On the hour' : 'Half past';
                        visualArea.appendChild(clockDiv);
                        visualArea.appendChild(timeLabel);
                        break;
                        
                    case 'multiplication':
                        for (let row = 0; row < visual.a; row++) {
                            const rowDiv = document.createElement('div');
                            rowDiv.style.display = 'flex';
                            rowDiv.style.justifyContent = 'center';
                            rowDiv.style.margin = '5px 0';
                            for (let col = 0; col < visual.b; col++) {
                                const item = document.createElement('div');
                                item.className = 'visual-item purple';
                                item.style.margin = '2px';
                                rowDiv.appendChild(item);
                            }
                            visualArea.appendChild(rowDiv);
                        }
                        break;
                        
                    case 'division':
                        const groupSize = visual.total / visual.groups;
                        for (let g = 0; g < visual.groups; g++) {
                            const groupDiv = document.createElement('div');
                            groupDiv.style.border = '2px dashed #666';
                            groupDiv.style.padding = '10px';
                            groupDiv.style.margin = '5px';
                            groupDiv.style.display = 'inline-block';
                            groupDiv.style.borderRadius = '10px';
                            
                            for (let i = 0; i < groupSize; i++) {
                                const item = document.createElement('div');
                                item.className = 'visual-item orange';
                                item.style.margin = '2px';
                                groupDiv.appendChild(item);
                            }
                            visualArea.appendChild(groupDiv);
                        }
                        break;
                        
                    case 'fraction':
                        const fractionDiv = document.createElement('div');
                        fractionDiv.style.display = 'grid';
                        fractionDiv.style.gridTemplateColumns = `repeat(${visual.denominator}, 1fr)`;
                        fractionDiv.style.gap = '5px';
                        fractionDiv.style.width = '200px';
                        fractionDiv.style.margin = '0 auto';
                        
                        for (let i = 0; i < visual.denominator; i++) {
                            const part = document.createElement('div');
                            part.style.width = '40px';
                            part.style.height = '40px';
                            part.style.border = '2px solid #333';
                            part.style.borderRadius = '5px';
                            if (i < visual.numerator) {
                                part.style.backgroundColor = '#4ecdc4';
                            } else {
                                part.style.backgroundColor = '#f0f0f0';
                            }
                            fractionDiv.appendChild(part);
                        }
                        visualArea.appendChild(fractionDiv);
                        break;
                        
                    case 'measurement':
                        const ruler = document.createElement('div');
                        ruler.style.width = '300px';
                        ruler.style.height = '40px';
                        ruler.style.background = 'linear-gradient(to right, #fff 0px, #fff 10px, #000 10px, #000 11px, #fff 11px)';
                        ruler.style.backgroundSize = '20px 100%';
                        ruler.style.border = '2px solid #333';
                        ruler.style.position = 'relative';
                        
                        const item = document.createElement('div');
                        item.textContent = visual.item;
                        item.style.position = 'absolute';
                        item.style.top = '-30px';
                        item.style.left = '0';
                        item.style.width = `${visual.length * 20}px`;
                        item.style.height = '20px';
                        item.style.backgroundColor = '#ff6b6b';
                        item.style.textAlign = 'center';
                        item.style.borderRadius = '5px';
                        item.style.color = 'white';
                        item.style.fontSize = '12px';
                        item.style.lineHeight = '20px';
                        
                        ruler.appendChild(item);
                        visualArea.appendChild(ruler);
                        break;
                }
            }

            displayAnswerOptions() {
                const optionsContainer = document.getElementById('answerOptions');
                optionsContainer.innerHTML = '';
                
                this.currentQuestion.options.forEach(option => {
                    const button = document.createElement('button');
                    button.className = 'answer-btn';
                    button.textContent = option;
                    button.addEventListener('click', () => {
                        this.checkAnswer(option, button);
                    });
                    optionsContainer.appendChild(button);
                });
            }

            checkAnswer(selectedAnswer, buttonElement) {
                const isCorrect = selectedAnswer === this.currentQuestion.correct;
                
                // Disable all buttons
                document.querySelectorAll('.answer-btn').forEach(btn => {
                    btn.disabled = true;
                });
                
                if (isCorrect) {
                    buttonElement.classList.add('correct');
                    this.score += 10;
                    this.streak++;
                    this.questionsCorrect++;
                    this.showFeedback(true, "Great job! üåü");
                    this.celebrate();
                } else {
                    buttonElement.classList.add('incorrect');
                    this.streak = 0;
                    
                    // Highlight correct answer
                    document.querySelectorAll('.answer-btn').forEach(btn => {
                        if (btn.textContent === this.currentQuestion.correct) {
                            btn.classList.add('correct');
                        }
                    });
                    
                    this.showFeedback(false, `The correct answer is ${this.currentQuestion.correct}. Try again! üí™`);
                }
                
                this.updateScore();
                document.getElementById('nextBtn').style.display = 'inline-block';
            }

            showFeedback(isCorrect, message) {
                const feedback = document.getElementById('feedback');
                feedback.textContent = message;
                feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
                feedback.style.display = 'block';
            }

            clearFeedback() {
                document.getElementById('feedback').style.display = 'none';
                
                // Re-enable buttons and clear classes
                document.querySelectorAll('.answer-btn').forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('correct', 'incorrect');
                });
            }

            showHint() {
                if (this.currentQuestion.hint) {
                    this.showFeedback(false, `üí° Hint: ${this.currentQuestion.hint}`);
                }
            }

            updateScore() {
                document.getElementById('scoreDisplay').textContent = `Score: ${this.score} | Streak: ${this.streak}`;
            }

            updateProgress() {
                const progress = (this.questionCount / this.totalQuestions) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
            }

            celebrate() {
                const celebration = document.getElementById('celebration');
                
                // Create confetti
                for (let i = 0; i < 20; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7'][Math.floor(Math.random() * 5)];
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    celebration.appendChild(confetti);
                    
                    // Remove confetti after animation
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }
            }

            endGame() {
                const percentage = Math.round((this.questionsCorrect / this.totalQuestions) * 100);
                let message = '';
                let emoji = '';
                
                if (percentage >= 90) {
                    message = "Outstanding! You're a math superstar!";
                    emoji = "üåü‚≠êüèÜ";
                } else if (percentage >= 80) {
                    message = "Excellent work! You're doing great!";
                    emoji = "üéâüëè";
                } else if (percentage >= 70) {
                    message = "Good job! Keep practicing!";
                    emoji = "üëçüòä";
                } else {
                    message = "Nice try! Practice makes perfect!";
                    emoji = "üí™üå±";
                }
                
                document.getElementById('questionDisplay').innerHTML = `
                    <h2>Game Complete! ${emoji}</h2>
                    <p>${message}</p>
                    <p>You got ${this.questionsCorrect} out of ${this.totalQuestions} questions correct!</p>
                    <p>Final Score: ${this.score}</p>
                `;
                
                document.getElementById('visualArea').innerHTML = '';
                document.getElementById('answerOptions').innerHTML = '';
                document.getElementById('nextBtn').style.display = 'none';
                
                // Add restart button
                const restartBtn = document.createElement('button');
                restartBtn.className = 'control-btn';
                restartBtn.textContent = 'üîÑ Play Again';
                restartBtn.addEventListener('click', () => {
                    this.selectTopic(this.currentTopic);
                });
                
                document.querySelector('.controls').appendChild(restartBtn);
                
                if (percentage >= 80) {
                    this.celebrate();
                }
            }
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new MathQuestApp();
        });
    </script>
</body>
</html>